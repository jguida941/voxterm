#!/bin/bash
#
# VoxTerm App Launcher
# Opens Terminal and runs the CLI
#

SCRIPT_DIR="$(cd "$(dirname "$0")/../../../../.." && pwd)"

# Ask user to select a project folder
PROJECT_DIR=$(osascript -e 'tell application "System Events"
    activate
    set selectedFolder to choose folder with prompt "Select your project folder:" default location (path to home folder)
    return POSIX path of selectedFolder
end tell' 2>/dev/null)

# If user cancelled, exit
if [ -z "$PROJECT_DIR" ]; then
    exit 0
fi

# Escape single quotes for AppleScript (replace ' with '\'' for shell quoting)
PROJECT_DIR_ESCAPED="${PROJECT_DIR//\'/\'\\\'\'}"
SCRIPT_DIR_ESCAPED="${SCRIPT_DIR//\'/\'\\\'\'}"

# Open Terminal and run the overlay in the selected project folder
osascript -e "tell application \"Terminal\"
    activate
    do script \"cd '${PROJECT_DIR_ESCAPED}' && '${SCRIPT_DIR_ESCAPED}/scripts/start.sh'\"
end tell"
